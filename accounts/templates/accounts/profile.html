{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen bg-[#b9cfcc] relative overflow-hidden pb-44">

  <!-- 背景：紙感＋薄いグラデ（掲示板と同系） -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-b from-white/10 via-transparent to-black/5"></div>
    <div class="absolute inset-0 opacity-[0.045]"
         style="background-image: radial-gradient(rgba(0,0,0,.35) 0.6px, transparent 0.6px);
                background-size: 14px 14px;"></div>
  </div>

  <!-- 装飾：少なめ（角に薄い波紋） -->
  <div class="absolute inset-0 pointer-events-none z-0">
    <div class="absolute left-6 top-16 w-28 h-28 rounded-full border border-white/18"></div>
    <div class="absolute right-8 bottom-28 w-36 h-36 rounded-full border border-white/12"></div>
  </div>

  <div class="relative z-10 max-w-xl mx-auto px-4 pt-10">

    <!-- タイトル -->
    <div class="flex items-center justify-between mb-5">
      <div>
        <h1 class="text-2xl font-bold text-[#2f2f2f] tracking-wide">プロフィール</h1>
        <p class="text-sm text-white/90 mt-1">アカウント情報を確認できます</p>
      </div>

      <!-- 右上の小アイコン（任意） -->
      <div class="w-11 h-11 rounded-2xl bg-white/60 border border-white/60 shadow-sm flex items-center justify-center">
        <svg class="w-6 h-6 text-[#2f2f2f]/70" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M20 21a8 8 0 1 0-16 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- カード -->
    <div class="bg-white/80 border border-white/70 rounded-2xl shadow-[0_16px_40px_rgba(0,0,0,0.14)] overflow-hidden">
      <!-- ヘッダー帯 -->
      <div class="px-6 py-5 border-b border-black/10 bg-white/60">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-2xl bg-black/5 flex items-center justify-center">
            <svg class="w-6 h-6 text-[#2f2f2f]/70" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 10l2-6h12l2 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M5 10v10h14V10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M9 20v-6h6v6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          <div>
            <p class="text-sm font-bold text-[#2f2f2f] leading-tight">ユーザー情報</p>
            <p class="text-xs text-[#2f2f2f]/60 mt-0.5">氏名・権限・所属など</p>
          </div>
        </div>
      </div>

      <div class="p-6 space-y-4">

        <!-- 氏名 -->
        <div class="rounded-2xl border border-black/10 bg-white/70 px-4 py-3">
          <p class="text-xs font-bold text-[#2f2f2f]/55">氏名</p>
          <p class="mt-1 text-lg font-bold text-[#2f2f2f]">{{ full_name }}</p>
        </div>

        <!-- 権限（少し控えめ） -->
        <div class="rounded-2xl border border-black/10 bg-white/70 px-4 py-3">
          <p class="text-xs font-bold text-[#2f2f2f]/55">権限</p>
          <p class="mt-1 text-base font-semibold text-[#2f2f2f]/80">{{ role }}</p>
        </div>


        <!-- ユーザーID（コピーできるボタンに変更） -->
        <div class="rounded-2xl border border-black/10 bg-white/70 px-4 py-3">
          <p class="text-xs font-bold text-[#2f2f2f]/55">ユーザーID</p>

          <div class="mt-1 flex items-center justify-between gap-3">
            <p id="user-id-text" class="font-mono text-sm text-[#2f2f2f]/80 break-all">{{ user_id }}</p>

            <button type="button"
                    id="copy-id-btn"
                    class="shrink-0 inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg bg-black/5 border border-black/10
                           text-xs font-bold text-[#2f2f2f]/75 hover:bg-black/10 transition"
                    data-copy-text="{{ user_id }}"
                    aria-label="ユーザーIDをコピー">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M8 8h10v12H8V8Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                <path d="M6 16H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              </svg>
              <span id="copy-id-label">コピー</span>
            </button>
          </div>

          <p id="copy-id-msg" class="mt-2 text-xs text-emerald-700 font-bold hidden">コピーしました</p>
        </div>

        <!-- 所属店舗 -->
        <div class="rounded-2xl border border-black/10 bg-white/70 px-4 py-3">
          <p class="text-xs font-bold text-[#2f2f2f]/55">所属店舗名</p>
          <p class="mt-1 text-sm font-bold text-[#2f2f2f]/85">{{ store_name }}</p>
        </div>

        <!-- 注意文（任意） -->
        <div class="text-xs text-[#2f2f2f]/60 px-1">
          ※ 権限や所属情報の変更が必要な場合は管理者へ連絡してください。
        </div>

        <!-- パスワード変更 -->
        <div class="pt-3">
          <button type="button"
                  id="change-password-btn"
                  class="w-full rounded-2xl border border-blue-200 bg-white/70 hover:bg-blue-50
                         text-blue-600 font-bold py-3 shadow-sm transition flex items-center justify-center gap-2">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 10V7a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <rect x="5" y="10" width="14" height="11" rx="2" stroke="currentColor" stroke-width="1.8"/>
              <circle cx="12" cy="15" r="1" fill="currentColor"/>
            </svg>
            パスワード変更
          </button>
        </div>

        <!-- ログアウト -->
        <div class="pt-3">
          <form action="{% url 'accounts:logout' %}" method="post">
            {% csrf_token %}
            <button type="submit"
                    class="w-full rounded-2xl border border-red-200 bg-white/70 hover:bg-red-50
                           text-red-600 font-bold py-3 shadow-sm transition flex items-center justify-center gap-2">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M10 17l1 3h10V4H11l-1 3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3 12h12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M7 8l-4 4 4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              ログアウト
            </button>
          </form>
        </div>

      </div>
    </div>

  </div>

  <!-- パスワード変更ダイアログ -->
  <div id="password-change-dialog" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <!-- 背景オーバーレイ -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="dialog-overlay"></div>

    <!-- モーダルコンテンツ -->
    <div class="relative bg-white rounded-3xl shadow-2xl max-w-md mx-4 p-8 border border-white/70">
      <!-- アイコン -->
      <div class="flex justify-center mb-4">
        <div class="w-16 h-16 rounded-2xl bg-blue-100 flex items-center justify-center">
          <svg class="w-8 h-8 text-blue-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 16v.01M12 12v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.8"/>
          </svg>
        </div>
      </div>

      <!-- タイトル -->
      <h2 class="text-2xl font-bold text-[#2f2f2f] text-center mb-3">
        パスワード変更について
      </h2>

      <!-- メッセージ -->
      <p class="text-[#2f2f2f]/70 text-center mb-6 leading-relaxed">
        デモ中のため、パスワード変更機能は<br>ご利用いただけません。
      </p>

      <!-- 閉じるボタン -->
      <button type="button"
              id="close-dialog-btn"
              class="w-full rounded-2xl bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 shadow-sm transition">
        閉じる
      </button>
    </div>
  </div>

</div>

<script>
  (function () {
    const btn = document.getElementById('copy-id-btn');
    const label = document.getElementById('copy-id-label');
    const msg = document.getElementById('copy-id-msg');

    if (!btn) return;

    const original = label ? label.textContent : 'コピー';
    let timer = null;

    function showCopied() {
      if (label) label.textContent = 'コピー済み';
      if (msg) msg.classList.remove('hidden');
      clearTimeout(timer);
      timer = setTimeout(() => {
        if (label) label.textContent = original;
        if (msg) msg.classList.add('hidden');
      }, 1400);
    }

    btn.addEventListener('click', async () => {
      const text = btn.getAttribute('data-copy-text') || '';
      if (!text) return;

      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          showCopied();
          return;
        }

        // フォールバック（http開発環境でも動く）
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly', '');
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        showCopied();
      } catch (e) {
        // 失敗時：何もしない（必要ならアラート出してもOK）
        console.error(e);
      }
    });
  })();

  // パスワード変更ダイアログ
  (function () {
    const dialog = document.getElementById('password-change-dialog');
    const openBtn = document.getElementById('change-password-btn');
    const closeBtn = document.getElementById('close-dialog-btn');
    const overlay = document.getElementById('dialog-overlay');

    if (!dialog || !openBtn || !closeBtn || !overlay) return;

    // ダイアログを開く
    openBtn.addEventListener('click', () => {
      dialog.classList.remove('hidden');
    });

    // ダイアログを閉じる
    function closeDialog() {
      dialog.classList.add('hidden');
    }

    closeBtn.addEventListener('click', closeDialog);
    overlay.addEventListener('click', closeDialog);

    // ESCキーで閉じる
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !dialog.classList.contains('hidden')) {
        closeDialog();
      }
    });
  })();
</script>
{% endblock %}
