<nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-sm z-50">
  <div class="flex justify-around items-center h-16 text-[11px]">

    {% with current=request.resolver_match.view_name %}

    <!-- 分析 -->
    <a href="{% url 'analytics:dashboard' %}"
       class="flex flex-col items-center gap-1
       {% if current == 'analytics:dashboard' %}
         text-primary
       {% else %}
         text-gray-400 hover:text-primary
       {% endif %}">
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
        <rect x="3" y="10" width="4" height="10" rx="1"/>
        <rect x="10" y="6" width="4" height="14" rx="1"/>
        <rect x="17" y="3" width="4" height="17" rx="1"/>
      </svg>
      <span>分析</span>
    </a>

    <!-- 掲示板 -->
    <a href="{% url 'bbs:list' %}"
       class="flex flex-col items-center gap-1
       {% if current == 'bbs:list' %}
         text-primary
       {% else %}
         text-gray-400 hover:text-primary
       {% endif %}">
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
        <path d="M4 4h16v11H7l-3 3V4z"/>
      </svg>
      <span>掲示板</span>
    </a>

    <!-- ホーム -->
    <a href="{% url 'common:index' %}"
       class="flex flex-col items-center gap-1
       {% if current == 'common:index' %}
         text-primary
       {% else %}
         text-gray-400 hover:text-primary
       {% endif %}">
      <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/>
      </svg>
      <span>ホーム</span>
    </a>

    <!-- AI -->
    <a href="{% url 'ai_features:chat_page' %}"
       class="flex flex-col items-center gap-1
       {% if current == 'ai_features:dashboard' %}
         text-primary
       {% else %}
         text-gray-400 hover:text-primary
       {% endif %}">
      <div class="w-6 h-6 rounded-full border-2 border-current flex items-center justify-center text-xs font-bold">
        AI
      </div>
      <span>AI</span>
    </a>

    <!-- その他 -->
    <button id="otherMenuBtn" type="button"
       class="flex flex-col items-center gap-1
       {% if current == 'accounts:profile' %}
         text-primary
       {% else %}
         text-gray-400 hover:text-primary
       {% endif %}">
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
        <rect x="3" y="5" width="18" height="2"/>
        <rect x="3" y="11" width="18" height="2"/>
        <rect x="3" y="17" width="18" height="2"/>
      </svg>
      <span>その他</span>
    </button>

    {% endwith %}
  </div>
</nav>

<!-- Backdrop -->
<div id="otherDrawerBackdrop"
     class="fixed inset-0 z-40 bg-black/30 hidden"></div>

<!-- Drawer -->
<div id="otherDrawer"
     class="fixed inset-x-0 bottom-0 z-50 translate-y-full transition-transform duration-200">
  <div class="bg-white rounded-t-3xl shadow-2xl">
    <!-- handle -->
    <div class="pt-3 pb-1 flex justify-center">
      <div class="h-1 w-24 bg-gray-200 rounded-full"></div>
    </div>

    <div class="px-8 pb-[calc(env(safe-area-inset-bottom)+2rem)]">
      <div class="h-px bg-gray-200 my-4"></div>

      <div class="grid grid-cols-3 gap-x-10 gap-y-10 justify-items-center">

        <!-- リスト機能 -->
        <a href="/list" data-drawer-close="1" class="flex flex-col items-center gap-3">
          <div class="w-24 h-24 rounded-2xl bg-teal-100 flex items-center justify-center">
            <svg class="w-10 h-10 text-gray-600" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16 4h-1.2A3 3 0 0 0 12 2a3 3 0 0 0-2.8 2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm-4-1a1 1 0 0 1 1 1h-2a1 1 0 0 1 1-1z"/>
            </svg>
          </div>
          <span class="text-gray-700">リスト機能</span>
        </a>

        <!-- ユーザー情報 -->
        <a href="/accounts/profile" data-drawer-close="1" class="flex flex-col items-center gap-3">
          <div class="w-24 h-24 rounded-2xl bg-teal-100 flex items-center justify-center">
            <svg class="w-10 h-10 text-gray-600" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4.4 0-8 2-8 4.5V21h16v-2.5C20 16 16.4 14 12 14z"/>
            </svg>
          </div>
          <span class="text-gray-700">ユーザー情報</span>
        </a>

        <!-- 準備中 -->
        <button type="button" disabled class="flex flex-col items-center gap-3 opacity-60 cursor-not-allowed">
          <div class="w-24 h-24 rounded-2xl bg-gray-200"></div>
          <span class="text-gray-400">準備中</span>
        </button>

        {% if user.user_type == 'manager' or user.user_type == 'admin' %}
        <a href="{% url 'accounts:staff_list' %}" data-drawer-close="1" class="flex flex-col items-center gap-3">
          <div class="w-24 h-24 rounded-2xl bg-teal-100 flex items-center justify-center">
            <svg class="w-10 h-10 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
          </div>
          <span class="text-gray-700">スタッフ編集</span>
        </a>
        {% else %}
        <button type="button" disabled class="flex flex-col items-center gap-3 opacity-60 cursor-not-allowed">
          <div class="w-24 h-24 rounded-2xl bg-gray-200"></div>
          <span class="text-gray-400">準備中</span>
        </button>
        {% endif %}

        <button type="button" disabled class="flex flex-col items-center gap-3 opacity-60 cursor-not-allowed">
          <div class="w-24 h-24 rounded-2xl bg-gray-200"></div>
          <span class="text-gray-400">準備中</span>
        </button>

        <button type="button" disabled class="flex flex-col items-center gap-3 opacity-60 cursor-not-allowed">
          <div class="w-24 h-24 rounded-2xl bg-gray-200"></div>
          <span class="text-gray-400">準備中</span>
        </button>

      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const btn = document.getElementById("otherMenuBtn");
    const drawer = document.getElementById("otherDrawer");
    const backdrop = document.getElementById("otherDrawerBackdrop");

    if (!btn || !drawer || !backdrop) return;

    let opened = false;

    function openDrawer() {
      if (opened) return;
      opened = true;

      backdrop.classList.remove("hidden");
      drawer.classList.remove("translate-y-full");
      document.documentElement.classList.add("overflow-hidden");
    }

    function closeDrawer() {
      if (!opened) return;
      opened = false;

      drawer.classList.add("translate-y-full");
      setTimeout(() => {
        if (!opened) backdrop.classList.add("hidden");
      }, 200);

      document.documentElement.classList.remove("overflow-hidden");
    }

    btn.addEventListener("click", () => (opened ? closeDrawer() : openDrawer()));
    backdrop.addEventListener("click", closeDrawer);

    drawer.addEventListener("click", (e) => {
      const el = e.target.closest("[data-drawer-close='1']");
      if (el) closeDrawer();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeDrawer();
    });
  })();
</script>
