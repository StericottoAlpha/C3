{% extends "base.html" %}

{% block title %}æ—¥å ±ç™»éŒ² - C3 ã‚¹ãƒ†ãƒªã‚³ãƒƒãƒˆÎ±{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#b9cfcc] relative overflow-hidden pb-44">

  <!-- èƒŒæ™¯ï¼šã†ã£ã™ã‚‰ç´™æ„Ÿ + ã‚°ãƒ©ãƒ‡ -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-b from-white/12 via-transparent to-black/5"></div>
    <div class="absolute inset-0 opacity-[0.06]"
         style="background-image: radial-gradient(rgba(0,0,0,.35) 0.6px, transparent 0.6px);
                background-size: 12px 12px;"></div>
  </div>

  <!-- èƒŒæ™¯è£…é£¾ï¼ˆæ§ãˆã‚ï¼šæ³¢ç´‹ï¼‹ãƒ‰ãƒƒãƒˆï¼‰ -->
  <div class="absolute inset-0 pointer-events-none z-0">
    <div class="absolute left-6 top-16 w-32 h-32 rounded-full border border-white/22"></div>
    <div class="absolute right-8 top-28 w-24 h-24 rounded-full border border-white/18"></div>
    <div class="absolute left-8 bottom-28 w-40 h-40 rounded-full border border-white/16"></div>
    <div class="absolute -right-14 -bottom-10 w-52 h-52 rounded-full border border-white/14"></div>

    <div class="absolute left-10 top-64 w-2 h-2 rounded-full bg-[#2f2f2f]/16"></div>
    <div class="absolute left-24 top-80 w-1.5 h-1.5 rounded-full bg-[#2f2f2f]/20"></div>
    <div class="absolute right-16 top-72 w-1.5 h-1.5 rounded-full bg-[#2f2f2f]/20"></div>
    <div class="absolute right-10 bottom-72 w-2 h-2 rounded-full bg-[#2f2f2f]/14"></div>
    <div class="absolute left-16 bottom-80 w-1.5 h-1.5 rounded-full bg-[#2f2f2f]/18"></div>
  </div>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæˆ»ã‚‹ï¼‹ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿ï¼‰ -->
  <div class="relative z-10 max-w-2xl mx-auto px-4 pt-8">
    <div class="flex items-start justify-between gap-3">
      <!-- å·¦ï¼šæˆ»ã‚‹ -->
      <a href="{% url 'common:index' %}"
         class="shrink-0 inline-flex items-center gap-2 text-[#2f2f2f] bg-white/60 hover:bg-white/80
                border border-white/60 rounded-full px-4 py-2 shadow-sm transition">
        <span class="text-lg">â†</span>
        <span class="text-sm font-semibold">æˆ»ã‚‹</span>
      </a>

      <!-- å³ï¼šã‚¿ã‚¤ãƒˆãƒ«ï¼‹èª¬æ˜ -->
      <div class="flex-1">
        <div class="text-right">
          <h1 class="text-2xl sm:text-3xl font-bold text-[#2f2f2f] tracking-wide">æ—¥å ±ç™»éŒ²</h1>
          <p class="mt-1 text-sm text-white/90">ç™ºç”Ÿã—ãŸå‡ºæ¥äº‹ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„</p>
        </div>
      </div>
    </div>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
    {% if messages %}
      <div class="mt-5 space-y-3">
        {% for message in messages %}
          <div class="rounded-2xl px-4 py-3 shadow-sm border border-white/60
                      {% if message.tags == 'success' %}bg-white/70 text-emerald-800{% else %}bg-white/70 text-rose-800{% endif %}">
            <p class="text-sm font-semibold">
              {% if message.tags == 'success' %}âœ…{% else %}âš ï¸{% endif %}
              {{ message }}
            </p>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- ãƒ•ã‚©ãƒ¼ãƒ æœ¬ä½“ -->
  <div class="relative z-10 max-w-2xl mx-auto px-4 mt-6">
    <div class="bg-white/75 border border-white/70 rounded-2xl shadow-[0_16px_40px_rgba(0,0,0,0.14)] overflow-hidden">
      <div class="px-5 sm:px-7 py-6">
        <form id="reportForm" method="post" enctype="multipart/form-data" class="space-y-6">
          {% csrf_token %}

          <!-- ã‚¸ãƒ£ãƒ³ãƒ« -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label for="{{ form.genre.id_for_label }}" class="text-sm font-bold text-[#2f2f2f]">
                ã‚¸ãƒ£ãƒ³ãƒ«
              </label>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full bg-rose-100 text-rose-700 border border-rose-200">
                å¿…é ˆ
              </span>
            </div>

            <div class="rounded-xl border border-black/10 bg-white/70 px-3 py-2 focus-within:ring-2 focus-within:ring-black/10">
              {{ form.genre }}
            </div>

            {% if form.genre.errors %}
              <p class="mt-2 text-sm text-rose-700 font-semibold">âš ï¸ {{ form.genre.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- ç™ºç”Ÿå ´æ‰€ -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label for="{{ form.location.id_for_label }}" class="text-sm font-bold text-[#2f2f2f]">
                ç™ºç”Ÿå ´æ‰€
              </label>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full bg-rose-100 text-rose-700 border border-rose-200">
                å¿…é ˆ
              </span>
            </div>

            <div class="rounded-xl border border-black/10 bg-white/70 px-3 py-2 focus-within:ring-2 focus-within:ring-black/10">
              {{ form.location }}
            </div>

            {% if form.location.errors %}
              <p class="mt-2 text-sm text-rose-700 font-semibold">âš ï¸ {{ form.location.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- ä»¶å -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label for="{{ form.title.id_for_label }}" class="text-sm font-bold text-[#2f2f2f]">
                ä»¶å
              </label>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full bg-rose-100 text-rose-700 border border-rose-200">
                å¿…é ˆ
              </span>
            </div>

            <div class="rounded-xl border border-black/10 bg-white/70 px-3 py-2 focus-within:ring-2 focus-within:ring-black/10">
              {{ form.title }}
            </div>

            {% if form.title.errors %}
              <p class="mt-2 text-sm text-rose-700 font-semibold">âš ï¸ {{ form.title.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- å†…å®¹ -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label for="{{ form.content.id_for_label }}" class="text-sm font-bold text-[#2f2f2f]">
                å†…å®¹
              </label>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full bg-rose-100 text-rose-700 border border-rose-200">
                å¿…é ˆ
              </span>
            </div>

            <div class="rounded-xl border border-black/10 bg-white/70 px-3 py-2 focus-within:ring-2 focus-within:ring-black/10 overflow-hidden">
              {{ form.content }}
            </div>

            <div class="mt-2 text-xs text-[#2f2f2f]/60">
              ã§ãã‚‹ã ã‘å…·ä½“çš„ã«æ›¸ãã¨ã€ã‚ã¨ã§æŒ¯ã‚Šè¿”ã‚Šã‚„ã™ã„ã§ã™ã€‚
            </div>

            {% if form.content.errors %}
              <p class="mt-2 text-sm text-rose-700 font-semibold">âš ï¸ {{ form.content.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- å†™çœŸ -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label for="{{ form.image.id_for_label }}" class="text-sm font-bold text-[#2f2f2f]">
                å†™çœŸ
              </label>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full bg-black/5 text-[#2f2f2f]/70 border border-black/10">
                ä»»æ„
              </span>
            </div>

            <label class="block rounded-2xl border border-dashed border-black/15 bg-white/55 hover:bg-white/70 transition cursor-pointer p-4">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-2xl bg-black/5 flex items-center justify-center">
                  <span class="text-xl">ğŸ“·</span>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-semibold text-[#2f2f2f]">å†™çœŸã‚’è¿½åŠ </p>
                  <p class="text-xs text-[#2f2f2f]/60 mt-1">
                    ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠï¼ˆ1æšï¼‰ / ç”»åƒã¯è¨˜éŒ²ã®è£œåŠ©ã«ä½¿ãˆã¾ã™
                  </p>
                  <p id="imageFileName" class="mt-2 text-xs text-[#2f2f2f]/70 hidden"></p>
                </div>
              </div>

              <div class="hidden">
                {{ form.image }}
              </div>
            </label>

            <div id="imagePreviewWrap" class="mt-3 hidden">
              <div class="rounded-2xl overflow-hidden border border-black/10 bg-white/60">
                <img id="imagePreview" alt="ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="w-full max-h-64 object-cover">
              </div>
            </div>

            {% if form.image.errors %}
              <p class="mt-2 text-sm text-rose-700 font-semibold">âš ï¸ {{ form.image.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- æ²ç¤ºæ¿ã«æŠ•ç¨¿ -->
          <div class="rounded-2xl border border-black/10 bg-white/55 p-4">
            <div class="flex items-center justify-between gap-4">
              <div>
                <p class="text-sm font-bold text-[#2f2f2f]">æ²ç¤ºæ¿ã«æŠ•ç¨¿</p>
                <p class="text-xs text-[#2f2f2f]/60 mt-1">
                  ãƒãƒ¼ãƒ ã«å…±æœ‰ã—ãŸã„å†…å®¹ã¯ONã«ã—ã¦ãã ã•ã„
                </p>
              </div>
              <div class="flex items-center gap-2">
                {{ form.post_to_bbs }}
                <label for="{{ form.post_to_bbs.id_for_label }}" class="text-sm text-[#2f2f2f]/70">
                  ON
                </label>
              </div>
            </div>
          </div>

          <!-- âœ… å…¥åŠ›ã®ä¸‹ï¼šã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼†æŠ•ç¨¿ï¼ˆãƒœãƒˆãƒ ãƒŠãƒ“ã¨è¢«ã‚‰ãªã„ï¼‰ -->
          <div class="pt-2">
            <div class="sticky bottom-24">
              <div class="bg-white/80 backdrop-blur border border-white/70 rounded-2xl
                          shadow-[0_12px_24px_rgba(0,0,0,0.16)] p-3 flex items-center gap-3">
                <a href="{% url 'common:index' %}"
                   class="flex-1 text-center py-3 rounded-xl border border-black/10 bg-white/70 hover:bg-white transition
                          font-bold text-[#2f2f2f]">
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </a>
                <button type="submit"
                        class="flex-[1.2] py-3 rounded-xl bg-primary hover:bg-primary-dark text-white transition
                               font-bold shadow">
                  æŠ•ç¨¿ã™ã‚‹
                </button>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  (function() {
    const imageInput = document.getElementById('{{ form.image.id_for_label }}');
    const fileNameEl = document.getElementById('imageFileName');
    const previewWrap = document.getElementById('imagePreviewWrap');
    const previewImg = document.getElementById('imagePreview');

    if (!imageInput) return;

    imageInput.addEventListener('change', function(e) {
      const file = e.target.files && e.target.files[0];
      if (!file) {
        fileNameEl.classList.add('hidden');
        previewWrap.classList.add('hidden');
        return;
      }

      fileNameEl.textContent = `é¸æŠä¸­ï¼š${file.name}`;
      fileNameEl.classList.remove('hidden');

      if (file.type && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          previewImg.src = ev.target.result;
          previewWrap.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      } else {
        previewWrap.classList.add('hidden');
      }
    });
  })();
</script>
{% endblock %}

